{"meta":{"instanceId":"YOUR_INSTANCE_ID","templateCredsSetupCompleted":true},"nodes":[{"id":"408c2c7c-3e0a-4a56-baae-d1334fffbb49","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-608,-224],"parameters":{"width":3008,"height":2400,"content":"# Nano Banana AI Product Image Creator via WhatsApp\n\n## ðŸš€ Node 1: WhatsApp Message Received\n**Type:** WhatsApp Trigger\n- **Updates:** Check \"messages\" only\n- **Credentials:** Add your WhatsApp Business API credentials\n- **Purpose:** Listens for incoming WhatsApp messages with images\n\n---\n\n## ðŸ“± Node 2: Get Media URL\n**Type:** WhatsApp\n- **Resource:** Media\n- **Operation:** Media URL Get\n- **Media ID:** `{{ $('WhatsApp Message Received').item.json.messages[0].image.id }}`\n- **Purpose:** Gets the download URL for the image sent by user\n\n---\n\n## â¬‡ï¸ Node 3: Download Image File\n**Type:** HTTP Request\n- **Method:** GET\n- **URL:** `{{ $json.url }}`\n- **Headers:** \n  - Name: `Authorization`\n  - Value: `Bearer YOUR_ACCESS_TOKEN`\n- **Response Format:** File\n- **Purpose:** Downloads the actual image file from WhatsApp servers\n\n---\n\n## ðŸ”„ Node 4: Image to Base64\n**Type:** Extract From File\n- **Operation:** Binary to Property\n- **Purpose:** Converts downloaded image to base64 format for AI processing\n\n---\n\n## ðŸ¤– Node 5: AI Design Analysis\n**Type:** Google Gemini\n- **Resource:** Image\n- **Operation:** Analyze\n- **Model:** `nano banana` or `gemini-2.5-flash-preview-05-20`\n- **Input Type:** Binary\n- **Text Prompt:** (Already configured - analyzes image for design improvements)\n- **Purpose:** AI analyzes the image and suggests design enhancements\n\n---\n\n## ðŸ”— Node 6: Combine Image & Analysis\n**Type:** Merge\n- **Settings:** Default merge settings\n- **Purpose:** Combines the base64 image data with AI analysis results\n\n---\n\n## âš™ï¸ Node 7: Prepare API Payload\n**Type:** Code (JavaScript)\n- **Code:** (Already configured)\n- **Purpose:** Formats data for Google Gemini image generation API\n\n---\n\n## ðŸŽ¨ Node 8: Generate Enhanced Image\n**Type:** HTTP Request\n- **Method:** POST\n- **URL:** `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent`\n- **Authentication:** Use Google Palm API credentials\n- **Body:** JSON (already configured)\n- **Purpose:** Generates enhanced image using AI\n\n---\n\n## ðŸ–¼ï¸ Node 9: Convert Base64 to Image\n**Type:** Convert to File\n- **Operation:** To Binary\n- **Source Property:** `candidates[0].content.parts[0].inlineData.data`\n- **Purpose:** Converts AI-generated base64 back to image file\n\n---\n\n## ðŸ“¤ Node 10: Send Image\n**Type:** WhatsApp\n- **Operation:** Send\n- **Phone Number ID:** Your WhatsApp Business phone number ID\n- **Recipient:** `+{{ $('WhatsApp Message Received').first().json.contacts[0].wa_id }}`\n- **Message Type:** Image\n- **Media Path:** Use Media in n8n\n- **Purpose:** Sends the enhanced image back to the user\n\n---\n\n## ðŸ”‘ Required Credentials:\n1. **WhatsApp Business API** - For receiving/sending messages\n2. **Google Palm/Gemini API** - For AI image analysis and generation\n\n## ðŸ“ Setup Notes:\n- Replace `YOUR_ACCESS_TOKEN` with your actual WhatsApp access token\n- Ensure all credentials are properly configured\n- Test with a simple image first\n- Monitor for API rate limits\n\n## âš ï¸ Important:\n- This workflow only triggers when users send images\n- Make sure your WhatsApp Business account has proper permissions\n- Keep your API tokens secure and rotate them regularly"},"typeVersion":1},{"id":"b2b1cb54-aad2-40f2-a6d3-82a87d7977b8","name":"WhatsApp Message Received","type":"n8n-nodes-base.whatsAppTrigger","position":[48,496],"webhookId":"YOUR_WEBHOOK_ID","parameters":{"options":{"messageStatusUpdates":[]},"updates":["messages"]},"credentials":{"whatsAppTriggerApi":{"id":"YOUR_WHATSAPP_TRIGGER_CRED_ID","name":"WhatsApp Trigger Credentials"}},"typeVersion":1},{"id":"df4cedfa-4dc9-4cbf-9a57-bda2169b43c6","name":"Get Media URL","type":"n8n-nodes-base.whatsApp","position":[288,496],"webhookId":"YOUR_WEBHOOK_ID_2","parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $('WhatsApp Message Received').item.json.messages[0].image.id }}"},"credentials":{"whatsAppApi":{"id":"YOUR_WHATSAPP_API_CRED_ID","name":"WhatsApp API Credentials"}},"typeVersion":1},{"id":"83ddeda5-6189-494c-909b-750d702dea18","name":"Download Image File","type":"n8n-nodes-base.httpRequest","position":[544,496],"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file"}}},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer YOUR_WHATSAPP_ACCESS_TOKEN"}]}},"typeVersion":4.2},{"id":"af69c54c-cc63-41ce-a938-a0f5a87773da","name":"Image to Base64","type":"n8n-nodes-base.extractFromFile","position":[880,400],"parameters":{"options":{},"operation":"binaryToPropery"},"typeVersion":1},{"id":"9ee51832-ec77-4887-ad02-ca6e0022a5fe","name":"AI Design Analysis","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[880,592],"parameters":{"text":"=You are a master creative director specializing in viral product advertisements. Transform the uploaded product image and caption {{ $('WhatsApp Message Received').item.json.messages[0].image.caption }} into a stunning commercial-grade advertisement that stops scrollers and drives sales.\n\nCORE RULES:\n- Keep the original product 100% unchanged - no alterations, replacements, or distortions\n- Use only user-provided text from the caption\n- Focus on premium visual enhancement and commercial appeal\n\nOUTPUT FORMAT - Return strictly as JSON:\n\n{\n  \"headline\": \"Use only user-provided text or leave empty\",\n  \"subheadline\": \"Use only user-provided text or leave empty\", \n  \"description\": \"Use only user-provided text or leave empty\",\n  \"call_to_action\": \"Use only user-provided text or leave empty\",\n  \"design_suggestions\": \"Create a detailed commercial photography concept:\n\nHERO SHOT COMPOSITION: Position the product as the absolute star using professional product photography techniques. Apply rule of thirds, golden ratio, and negative space for maximum visual impact. Create depth layers with foreground, middle ground, and background elements.\n\nPREMIUM LIGHTING SETUP: Design studio-quality lighting with key light at 45-degree angle, fill light to reduce shadows, rim light for edge definition, and background light for separation. Add subtle color temperature variations - warm highlights (3200K) and cool shadows (5600K) for dimension.\n\nLUXURY BACKGROUND: Choose from these premium options:\n- Minimalist: Clean white/gray gradient with subtle texture\n- Marble: Polished Carrara marble surface with natural veining  \n- Fabric: Flowing silk or velvet draping in complementary colors\n- Industrial: Brushed metal, concrete, or glass surfaces\n- Natural: Stone, wood grain, or organic textures\n\nCINEMATIC COLOR GRADING: Apply professional color correction with:\n- Primary colors: Enhance product's natural colors by 15-20%\n- Secondary colors: Desaturate background by 10-15% to make product pop\n- Shadows: Add subtle blue/teal tint (-5 temperature)\n- Highlights: Warm golden tone (+10 temperature)\n- Overall: Increase contrast by 20%, add film grain for premium feel\n\nVISUAL EFFECTS & POLISH: Add sophisticated finishing touches:\n- Soft focus background (f/2.8 depth of field effect)  \n- Subtle product reflections on surface\n- Elegant shadow casting with 70% opacity\n- Gentle rim lighting glow around product edges\n- Optional: Floating particles or light rays for magic\n\nADVERTISEMENT STYLE: Make it look like a premium brand campaign - think Apple product launches, luxury fashion ads, or high-end cosmetic commercials. The final image should be Instagram-worthy, Pinterest-perfect, and conversion-focused.\n\nTECHNICAL SPECS: 16:9 aspect ratio, high resolution, sharp product focus, cinematic lighting, commercial photography style, premium brand aesthetic.\n\nDescribe every visual element in detail (400+ words) to create a show-stopping advertisement that makes people want to buy immediately.\"\n}","modelId":{"__rl":true,"mode":"list","value":"models/gemini-2.5-flash-preview-05-20","cachedResultName":"models/gemini-2.5-flash-preview-05-20"},"options":{},"resource":"image","inputType":"binary","operation":"analyze"},"credentials":{"googlePalmApi":{"id":"YOUR_GOOGLE_API_CRED_ID","name":"Google API Credentials"}},"typeVersion":1},{"id":"f78cef2a-30a8-4bef-a6bd-f17a0b7543de","name":"Combine Image & Analysis","type":"n8n-nodes-base.merge","position":[1200,496],"parameters":{},"typeVersion":3.2},{"id":"e02461e3-16c5-45ab-b5fc-c8f1c8561cff","name":"Prepare API Payload","type":"n8n-nodes-base.code","position":[1408,496],"parameters":{"jsCode":"// Collect all items from both inputs\nconst input1 = $items(\"Combine Image & Analysis\").map(i => i.json);\nconst input2 = $items(\"Combine Image & Analysis\").map(i => i.json);\n\n// Return as a single item\nreturn [\n  {\n    json: {\n      input1: input1,\n      input2: input2\n    }\n  }\n];\n"},"typeVersion":2},{"id":"5d14ccf3-70cc-4be6-9c28-8046207aacbf","name":"Generate Enhanced Image","type":"n8n-nodes-base.httpRequest","position":[1648,496],"parameters":{"url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent","method":"POST","options":{},"jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": {{ JSON.stringify($json.input1[1].content.parts[0].text) }}\n        },\n        {\n          \"inlineData\": {\n            \"mimeType\": \"image/png\",\n            \"data\": \"{{ $json.input1[0].data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\"TEXT\", \"IMAGE\"]\n  }\n}","sendBody":true,"specifyBody":"json","authentication":"predefinedCredentialType","nodeCredentialType":"googlePalmApi"},"credentials":{"googlePalmApi":{"id":"YOUR_GOOGLE_API_CRED_ID_2","name":"Google API Credentials"}},"typeVersion":4.2},{"id":"ae68ba68-2df4-4fb3-bf8f-d83c6f19e3fd","name":"Convert Base64 to Image","type":"n8n-nodes-base.convertToFile","position":[1872,496],"parameters":{"options":{},"operation":"toBinary","sourceProperty":"candidates[0].content.parts[0].inlineData.data"},"typeVersion":1.1},{"id":"46305e1c-aac0-4722-a512-52e58c15e9b2","name":"Send Image","type":"n8n-nodes-base.whatsApp","position":[2080,496],"webhookId":"YOUR_WEBHOOK_ID_3","parameters":{"mediaPath":"useMedian8n","operation":"send","messageType":"image","phoneNumberId":"YOUR_PHONE_NUMBER_ID","additionalFields":{},"recipientPhoneNumber":"=+{{ $('WhatsApp Message Received').first().json.contacts[0].wa_id }}"},"credentials":{"whatsAppApi":{"id":"YOUR_WHATSAPP_SEND_CRED_ID","name":"WhatsApp Send Credentials"}},"typeVersion":1}],"pinData":{},"connections":{"Get Media URL":{"main":[[{"node":"Download Image File","type":"main","index":0}]]},"Image to Base64":{"main":[[{"node":"Combine Image & Analysis","type":"main","index":0}]]},"AI Design Analysis":{"main":[[{"node":"Combine Image & Analysis","type":"main","index":1}]]},"Download Image File":{"main":[[{"node":"Image to Base64","type":"main","index":0},{"node":"AI Design Analysis","type":"main","index":0}]]},"Prepare API Payload":{"main":[[{"node":"Generate Enhanced Image","type":"main","index":0}]]},"Convert Base64 to Image":{"main":[[{"node":"Send Image","type":"main","index":0}]]},"Generate Enhanced Image":{"main":[[{"node":"Convert Base64 to Image","type":"main","index":0}]]},"Combine Image & Analysis":{"main":[[{"node":"Prepare API Payload","type":"main","index":0}]]},"WhatsApp Message Received":{"main":[[{"node":"Get Media URL","type":"main","index":0}]]}}}